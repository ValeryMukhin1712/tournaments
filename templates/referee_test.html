<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Referee</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .referee-container {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
        }
        .referee-iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 8px;
        }
        .test-form {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .result-display {
            background-color: #d1ecf1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">üè∏ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º Referee</h1>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <div class="test-form">
                    <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h4>
                    <form id="testForm">
                        <div class="mb-3">
                            <label for="participant1" class="form-label">–£—á–∞—Å—Ç–Ω–∏–∫ 1 (–ª–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞):</label>
                            <input type="text" class="form-control" id="participant1" 
                                   value="–ò–≤–∞–Ω-–ü–µ—Ç—Ä" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω-–ü–µ—Ç—Ä">
                            <div class="form-text">–ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∏—Ä–µ, —Ç–æ –¥–æ —Ç–∏—Ä–µ - –Ω–∏–∂–Ω–∏–π –∏–≥—Ä–æ–∫, –ø–æ—Å–ª–µ - –≤–µ—Ä—Ö–Ω–∏–π</div>
                        </div>
                        <div class="mb-3">
                            <label for="participant2" class="form-label">–£—á–∞—Å—Ç–Ω–∏–∫ 2 (–ø—Ä–∞–≤–∞—è –∫–æ–º–∞–Ω–¥–∞):</label>
                            <input type="text" class="form-control" id="participant2" 
                                   value="–ú–∞—Ä–∏—è" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ä–∏—è">
                            <div class="form-text">–ï—Å–ª–∏ –±–µ–∑ —Ç–∏—Ä–µ, —Ç–æ –∏–º—è –±—É–¥–µ—Ç –≤ –æ–±–æ–∏—Ö –ø–æ–ª—è—Ö</div>
                        </div>
                        <div class="mb-3">
                            <label for="tournamentName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                            <input type="text" class="form-control" id="tournamentName" 
                                   value="–¢–µ—Å—Ç–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="loadReferee()">
                            üè∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å Referee
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearResult()">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </form>
                </div>
                
                <div class="result-display" id="resultDisplay" style="display: none;">
                    <h5>–†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞:</h5>
                    <div id="resultContent"></div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="referee-container">
                    <h4>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Referee</h4>
                    <div id="refereeContent">
                        <div class="text-center text-muted">
                            <p>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å Referee" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>–ü—Ä–æ—Å—Ç—ã–µ –∏–º–µ–Ω–∞:</h6>
                                <ul>
                                    <li><code>–ò–≤–∞–Ω</code> ‚Üí –æ–±–∞ –ø–æ–ª—è: "–ò–≤–∞–Ω"</li>
                                    <li><code>–ü–µ—Ç—Ä</code> ‚Üí –æ–±–∞ –ø–æ–ª—è: "–ü–µ—Ç—Ä"</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>–ò–º–µ–Ω–∞ —Å —Ç–∏—Ä–µ:</h6>
                                <ul>
                                    <li><code>–ò–≤–∞–Ω-–ü–µ—Ç—Ä</code> ‚Üí –Ω–∏–∂–Ω–∏–π: "–ò–≤–∞–Ω", –≤–µ—Ä—Ö–Ω–∏–π: "–ü–µ—Ç—Ä"</li>
                                    <li><code>–ú–∞—Ä–∏—è-–ê–Ω–Ω–∞</code> ‚Üí –Ω–∏–∂–Ω–∏–π: "–ú–∞—Ä–∏—è", –≤–µ—Ä—Ö–Ω–∏–π: "–ê–Ω–Ω–∞"</li>
                                </ul>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>–°–º–µ—à–∞–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏:</h6>
                                <ul>
                                    <li><code>–ê–ª–µ–∫—Å–µ–π</code> vs <code>–ú–∞—Ä–∏—è-–ê–Ω–Ω–∞</code></li>
                                    <li><code>–ò–≤–∞–Ω-–ü–µ—Ç—Ä</code> vs <code>–°–µ—Ä–≥–µ–π</code></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>–û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏:</h6>
                                <ul>
                                    <li><code>–ò–≤–∞–Ω-–ü–µ—Ç—Ä-–°–∏–¥–æ—Ä</code> ‚Üí –Ω–∏–∂–Ω–∏–π: "–ò–≤–∞–Ω", –≤–µ—Ä—Ö–Ω–∏–π: "–ü–µ—Ç—Ä-–°–∏–¥–æ—Ä"</li>
                                    <li>–ü—É—Å—Ç—ã–µ –∏–º–µ–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadReferee() {
            const participant1 = document.getElementById('participant1').value;
            const participant2 = document.getElementById('participant2').value;
            const tournamentName = document.getElementById('tournamentName').value;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('refereeContent').innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Referee...</p>
                </div>
            `;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é HTML
            fetch('/api/referee/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    participant1: participant1,
                    participant2: participant2,
                    tournament_name: tournamentName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –í—Å—Ç–∞–≤–ª—è–µ–º HTML –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    document.getElementById('refereeContent').innerHTML = data.html;
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç iframe
                    setupMessageHandler();
                } else {
                    document.getElementById('refereeContent').innerHTML = `
                        <div class="alert alert-danger">
                            <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                            <p>${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('refereeContent').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Referee: ${error.message}</p>
                    </div>
                `;
            });
        }
        
        function setupMessageHandler() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Referee
            window.addEventListener('message', function(event) {
                if (event.data.type === 'refereeResult') {
                    displayResult(event.data);
                }
            });
        }
        
        function displayResult(data) {
            const resultDisplay = document.getElementById('resultDisplay');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>–°—á–µ—Ç –º–∞—Ç—á–∞:</h6>
                        <p class="h4 text-primary">${data.scoreLeft} : ${data.scoreRight}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</h6>
                        <p><strong>–õ–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞:</strong> ${data.leftTop} / ${data.leftBottom}</p>
                        <p><strong>–ü—Ä–∞–≤–∞—è –∫–æ–º–∞–Ω–¥–∞:</strong> ${data.rightTop} / ${data.rightBottom}</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>–î–µ—Ç–∞–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–º–µ–Ω:</h6>
                        <div class="alert alert-info">
                            <p><strong>–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong></p>
                            <p>–£—á–∞—Å—Ç–Ω–∏–∫ 1: "${document.getElementById('participant1').value}"</p>
                            <p>–£—á–∞—Å—Ç–Ω–∏–∫ 2: "${document.getElementById('participant2').value}"</p>
                            <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong></p>
                            <p>–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π: "${data.leftTop}" | –õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π: "${data.leftBottom}"</p>
                            <p>–ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π: "${data.rightTop}" | –ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π: "${data.rightBottom}"</p>
                        </div>
                    </div>
                </div>
            `;
            
            resultDisplay.style.display = 'block';
        }
        
        function clearResult() {
            document.getElementById('refereeContent').innerHTML = `
                <div class="text-center text-muted">
                    <p>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å Referee" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                </div>
            `;
            document.getElementById('resultDisplay').style.display = 'none';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
        });
    </script>
</body>
</html>


