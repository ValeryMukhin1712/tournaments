<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="">
    <meta name="application-name" content="">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-tap-highlight" content="no">
    <title></title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        @media screen {
            body {
                -webkit-app-region: no-drag;
            }
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        title {
            display: none !important;
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞ */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            height: 100vh !important;
            width: 100vw !important;
        }
        
        /* –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞ */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
        head, title, meta {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã */
        html {
            height: 100vh !important;
            width: 100vw !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
        }
        
        body {
            height: 100vh !important;
            width: 100vw !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }
        .container { 
            height: 100vh; 
            width: 100vw; 
            margin: 0; 
            padding: 0; 
            display: flex;
            flex-direction: column;
        }
        .court { 
            background: rgba(76, 175, 80, 0.1); 
            border: none; 
            border-radius: 0; 
            position: relative; 
            flex: 1;
            width: 100%;
            height: 100%;
            margin: 0;
            background-image: url('/static/referee/court.jpg');
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
            overflow: hidden;
        }
        .net { 
            position: absolute; 
            left: 50%; 
            top: 0; 
            width: 3px; 
            height: 100%; 
            background: #fff; 
            transform: translateX(-50%);
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .half { 
            position: absolute; 
            top: 0; 
            width: 50%; 
            height: 100%; 
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .half:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .half:active {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(0.98);
        }
        .half.clicked {
            background-color: rgba(0, 255, 0, 0.3);
            animation: clickEffect 0.3s ease-out;
        }
        
        @keyframes clickEffect {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); background-color: rgba(0, 255, 0, 0.5); }
            100% { transform: scale(1); }
        }
        .left { left: 0; }
        .right { right: 0; }
        .segments { display: flex; flex-direction: column; height: 100%; }
        .segment { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
        }
        
        /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è */
        .segment:first-child {
            align-items: flex-start;
            padding-top: 15%;
        }
        
        .segment:last-child {
            align-items: flex-end;
            padding-bottom: 15%;
        }
        .box { 
            text-align: center; 
            padding: 10px; 
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
        }
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–µ—Ä—Ö–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ */
        #top_left .box, #top_right .box {
            top: 20px;
            bottom: auto;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∏–∂–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ */
        #bottom_left .box, #bottom_right .box {
            bottom: 20px;
            top: auto;
        }
        .hint { color: #fff; font-size: 12px; margin-bottom: 5px; }
        input { 
            padding: 4px; 
            border: none; 
            border-radius: 3px; 
            width: 200px; 
            font-size: 36px;
            visibility: visible !important;
            opacity: 1 !important;
            display: block !important;
        }
        
        /* –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∏–º–µ–Ω */
        #name_top_left, #name_bottom_left {
            border: 2px solid #2196F3 !important; /* –°–∏–Ω—è—è —Ä–∞–º–∫–∞ –¥–ª—è –ª–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã */
        }
        
        #name_top_right, #name_bottom_right {
            border: 2px solid #f44336 !important; /* –ö—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –ø—Ä–∞–≤–æ–π –∫–æ–º–∞–Ω–¥—ã */
        }
        
        .server-indicator { 
            margin-bottom: 5px; 
            position: absolute;
            transition: transform 0.2s ease-in-out;
            top: calc(50% - 18.5px);
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .server-indicator img { 
            width: 75px; 
            height: 75px; 
            border: 1px solid red; 
            background-color: yellow;
            display: block;
            border-radius: 50%;
            padding: 4px;
            box-sizing: border-box;
            object-fit: contain;
        }
        .controls { 
            text-align: center; 
            margin: 0; 
            padding: 10px; 
            background: rgba(255, 255, 255, 0.9);
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        .controls button { 
            margin: 0 8px; 
            padding: 6px 8px; 
            font-size: 14px; 
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .controls button:hover {
            transform: scale(1.1);
        }
        
        .finish-btn {
            background-color: #007bff !important;
            color: white !important;
            border: none !important;
            padding: 6px 8px !important;
            font-size: 14px !important;
            font-weight: bold !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            width: 30px !important;
            height: 30px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            margin: 0 !important;
        }
        
        .finish-btn:hover {
            background-color: #0056b3 !important;
            transform: scale(1.1) !important;
        }
        .start-game-btn { margin-top: 0; }
        .start-game-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 6px 8px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .start-game-btn:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }
        .start-game-btn:not(:disabled):hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        .scoreboard-container { 
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
            display: flex;
            gap: 15vw;
            align-items: center;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .score-left {
            transform: translateX(1.5vw); /* –°–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ */
        }
        
        .score-right {
            transform: translateX(-1.5vw); /* –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ */
        }
        
        .score-left, .score-right {
            font-size: 52.5vh; 
            font-weight: bold; 
            text-align: center; 
            text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
            padding: 1.5vh 3vw;
            min-width: 12vw;
            visibility: visible !important;
            opacity: 1 !important;
            display: block !important;
        }
        
        .score-left {
            color: #2196F3; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è –ª–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã */
        }
        
        .score-right {
            color: #f44336; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø—Ä–∞–≤–æ–π –∫–æ–º–∞–Ω–¥—ã */
        }
        
        .score-buttons-left, .score-buttons-right {
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏, —Ç–∞–∫ –∫–∞–∫ —Å—á–µ—Ç —Ç–µ–ø–µ—Ä—å –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ—Ä—Ç–∞ */
        }
        .score-button { 
            font-size: 24px; 
            font-weight: bold; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            border: 3px solid #4CAF50; 
            background-color: #4CAF50; 
            color: white; 
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        .score-button:hover { 
            background-color: #45a049; 
            transform: scale(1.1); 
        }
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "+" */
        #btnPlusLeft, #btnPlusRight {
            width: 200px;
            height: 90px;
            border-radius: 45px;
            font-size: 36px;
        }
        .minus-button {
            background-color: #f44336;
            border-color: #f44336;
        }
        .minus-button:hover {
            background-color: #da190b;
        }
        .footer { text-align: center; color: #666; font-size: 12px; margin-top: 20px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–±–µ–¥—ã */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
            animation: slideIn 0.3s;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 15px;
            top: 10px;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .victory-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .victory-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
        }
        
        .victory-text {
            color: #4CAF50;
            font-size: 32px;
            margin: 0;
            font-weight: bold;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∂—É—Ä–Ω–∞–ª–∞ –ø–æ–¥–∞—á */
        .journal-container {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            height: 400px;
            background-color: #fff;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 100;
            transition: all 0.3s ease;
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        
        .journal-container.visible {
            display: block; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ */
        }
        
        .journal-container.expanded {
            width: 500px;
            height: 600px;
        }
        
        .journal-header {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .journal-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .match-input {
            width: 60px;
            padding: 2px 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
        }
        
        .find-btn {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .find-btn:hover {
            background-color: rgba(255,255,255,0.2);
        }
        
        .journal-header h3 {
            margin: 0;
            font-size: 16px;
        }
        
        .expand-btn, .stats-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .expand-btn:hover, .stats-btn:hover {
            background-color: rgba(255,255,255,0.2);
        }
        
        .journal-content {
            height: calc(100% - 50px);
            overflow-y: auto;
            padding: 10px;
        }
        
        .journal-entry {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            margin-bottom: 5px;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .journal-entry.success {
            border-left: 4px solid #4CAF50;
        }
        
        .journal-entry.returned {
            border-left: 4px solid #ff9800;
        }
        
        .journal-placeholder {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 50px;
        }
        
        .entry-time {
            color: #666;
            font-weight: bold;
        }
        
        .entry-players {
            margin: 2px 0;
        }
        
        .entry-result {
            font-weight: bold;
        }
        
        .entry-result.success {
            color: #4CAF50;
        }
        
        .entry-result.returned {
            color: #ff9800;
        }
        
        .entry-score {
            font-size: 10px;
            color: #666;
            font-weight: bold;
            margin-top: 2px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-content h4, .stats-content h5 {
            color: #4CAF50;
            margin: 10px 0 5px 0;
        }
        
        .player-stats, .game-summary {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            margin: 5px 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .player-stats {
            border-left: 3px solid #4CAF50;
        }
        
        .game-summary {
            border-left: 3px solid #2196F3;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .controls {
                padding: 5px;
            }
            
            .controls button {
                margin: 0 6px;
                padding: 5px 6px;
                font-size: 12px;
                width: 28px;
                height: 28px;
            }
            
            .start-game-btn {
                padding: 5px 6px;
                font-size: 12px;
                width: 28px;
                height: 28px;
            }
            
            .finish-btn {
                width: 28px !important;
                height: 28px !important;
                font-size: 12px !important;
                padding: 5px 6px !important;
            }
            
            .scoreboard-container {
                gap: 8vw;
            }
            
            .score-left, .score-right {
                font-size: 8vw;
                padding: 0.5vh 1vw;
                min-width: 8vw;
            }
            
            
            input {
                width: 120px;
                font-size: 27px;
                padding: 2px;
            }
            
            .box {
                width: 70px;
            }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            .scoreboard-container {
                gap: 10vw;
            }
            
            .score-left, .score-right {
                font-size: 8vw;
                padding: 0.8vh 1.5vw;
                min-width: 8vw;
            }
            
            
            input {
                width: 140px;
                font-size: 27px;
                padding: 2px;
            }
            
            .box {
                width: 80px;
            }
            
            .controls button {
                margin: 0 4px;
                padding: 4px 5px;
                font-size: 10px;
                width: 24px;
                height: 24px;
            }
            
            .start-game-btn {
                padding: 4px 5px;
                font-size: 10px;
                width: 24px;
                height: 24px;
            }
            
            .finish-btn {
                width: 24px !important;
                height: 24px !important;
                font-size: 10px !important;
                padding: 4px 5px !important;
            }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-width: 1920px) {
            .scoreboard-container {
                gap: 18vw;
            }
            
            .score-left, .score-right {
                font-size: 14vw;
                padding: 2vh 4vw;
                min-width: 14vw;
            }
            
            
            input {
                width: 260px;
                font-size: 42px;
                padding: 6px;
            }
            
            .box {
                width: 150px;
            }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
        @media (orientation: portrait) and (max-height: 600px) {
            .court {
                height: 100vh;
                background-size: contain;
            }
            
            .scoreboard-container {
                gap: 8vw;
            }
            
            .score-left, .score-right {
                font-size: 6vw;
                padding: 0.5vh 1vw;
                min-width: 6vw;
            }
            
            
            input {
                width: 120px;
                font-size: 24px;
                padding: 2px;
            }
            
            .box {
                width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <button id="btnSave" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º–µ–Ω–∞">üíæ</button>
            <button id="btnStartGame" class="start-game-btn" title="–ù–∞—á–∞—Ç—å –∏–≥—Ä—É">‚ñ∂Ô∏è</button>
            <button id="btnUndo" title="–û—Ç–º–µ–Ω–∏—Ç—å">‚Ü∂</button>
            <button id="btnClear" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë">üóëÔ∏è</button>
            <button id="btnMoveShuttlecock" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ø–æ–¥–∞—á—É">üè∏</button>
            <button id="btnToggleJournal" title="–ñ—É—Ä–Ω–∞–ª –ø–æ–¥–∞—á">üìã</button>
        </div>

        <div class="court">
            <div class="net"></div>
            
            <!-- –°—á–µ—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ—Ä—Ç–∞ -->
            <div class="scoreboard-container">
                <div class="score-left" id="scoreLeft">0</div>
                <div class="score-right" id="scoreRight">0</div>
            </div>
            
            <div class="half left" id="court_left" title="–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ –ª–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã">
                <div class="segments">
                    <div class="segment" id="top_left">
                        <div class="box">
                            <div class="server-indicator" title="–ü–æ–¥–∞—ë—Ç" style="display: none;"><img src="/static/referee/img_01.png" alt="–ü–æ–¥–∞—é—â–∏–π" /></div>
                            <input type="text" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" id="name_top_left" value="{{ participant1.split('-')[0] if '-' in participant1 else participant1 }}" />
                        </div>
                    </div>
                    <div class="segment" id="bottom_left">
                        <div class="box">
                            <div class="server-indicator" title="–ü–æ–¥–∞—ë—Ç" style="display: none;"><img src="/static/referee/img_01.png" alt="–ü–æ–¥–∞—é—â–∏–π" /></div>
                            <input type="text" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" id="name_bottom_left" value="{{ participant1.split('-')[1] if '-' in participant1 and len(participant1.split('-')) > 1 else participant1 }}" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="half right" id="court_right" title="–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ –ø—Ä–∞–≤–æ–π –∫–æ–º–∞–Ω–¥—ã">
                <div class="segments">
                    <div class="segment" id="top_right">
                        <div class="box">
                            <div class="server-indicator" title="–ü–æ–¥–∞—ë—Ç"><img src="/static/referee/img_01.png" alt="–ü–æ–¥–∞—é—â–∏–π" /></div>
                            <input type="text" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" id="name_top_right" value="{{ participant2.split('-')[0] if '-' in participant2 else participant2 }}" />
                        </div>
                    </div>
                    <div class="segment" id="bottom_right">
                        <div class="box">
                            <div class="server-indicator" title="–ü–æ–¥–∞—ë—Ç" style="display: none;"><img src="/static/referee/img_01.png" alt="–ü–æ–¥–∞—é—â–∏–π" /></div>
                            <input type="text" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" id="name_bottom_right" value="{{ participant2.split('-')[1] if '-' in participant2 and len(participant2.split('-')) > 1 else participant2 }}" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- –ñ—É—Ä–Ω–∞–ª –ø–æ–¥–∞—á -->
    <div class="journal-container">
        <div class="journal-header">
            <h3>–ñ—É—Ä–Ω–∞–ª –ø–æ–¥–∞—á</h3>
            <div class="journal-controls">
                <input type="number" id="matchNumberInput" placeholder="‚Ññ –º–∞—Ç—á–∞" min="1" class="match-input">
                <button id="btnFindMatch" class="find-btn" title="–ù–∞–π—Ç–∏ –º–∞—Ç—á">üîç</button>
                <button id="btnShowStats" class="stats-btn" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">üìä</button>
                <button id="btnExpandJournal" class="expand-btn" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∂—É—Ä–Ω–∞–ª">üìñ</button>
            </div>
        </div>
        <div id="journalContent" class="journal-content">
            <div class="journal-placeholder">–ñ—É—Ä–Ω–∞–ª –Ω–∞—á–Ω–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–±–µ–¥—ã -->
    <div id="victoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVictoryModal()">&times;</span>
            <div class="victory-content">
                <img src="/static/referee/img_02.png" alt="–ü–æ–±–µ–¥–∞" class="victory-image">
                <h2 id="victoryMessage" class="victory-text">–ü–æ–±–µ–¥–∞!</h2>
            </div>
        </div>
    </div>

    <script>
        const ids = [
            'name_top_left', 'name_bottom_left',
            'name_top_right', 'name_bottom_right'
        ];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä clear –∏ –æ—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        const urlParams = new URLSearchParams(window.location.search);
        const clearData = urlParams.get('clear') === 'true';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        window.scoreLeft = 0;
        window.scoreRight = 0;
        let shuttlecockPosition = 'top_right'; // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –≤–æ–ª–∞–Ω–∞
        window.gameStarted = false;
        let gameStartTime = null;
        let timerInterval = null;
        let journalEntries = [];
        let currentGameId = null;
        let gameEndTime = null;
        let gameHistory = []; // –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–≥—Ä—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞
        let isAnimating = false;
        
        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –¥–µ–ª–∞–µ–º —ç—Ç–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        if (clearData) {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞
            window.scoreLeft = 0;
            window.scoreRight = 0;
            window.gameStarted = false;
            shuttlecockPosition = 'top_right';
            gameStartTime = null;
            gameEndTime = null;
            journalEntries = [];
            currentGameId = null;
            gameHistory = [];
            isAnimating = false;
            
            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.removeItem('court_score_left');
            localStorage.removeItem('court_score_right');
            localStorage.removeItem('court_shuttlecock_position');
            localStorage.removeItem('court_name_top_left');
            localStorage.removeItem('court_name_bottom_left');
            localStorage.removeItem('court_name_top_right');
            localStorage.removeItem('court_name_bottom_right');
            
            console.log('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function updateScore() {
            const scoreLeftElement = document.getElementById('scoreLeft');
            const scoreRightElement = document.getElementById('scoreRight');
            
            if (scoreLeftElement) {
                scoreLeftElement.textContent = window.scoreLeft;
            }
            if (scoreRightElement) {
                scoreRightElement.textContent = window.scoreRight;
            }
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º updateScore —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
        updateScore();
        
        console.log('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, gameStarted:', window.gameStarted);
        
        // –ï—Å–ª–∏ –ù–ï –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
        if (!clearData) {
            load();
        }

        function saveGameState() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            gameHistory.push({
                scoreLeft: window.scoreLeft,
                scoreRight: window.scoreRight,
                shuttlecockPosition: shuttlecockPosition,
                gameStarted: window.gameStarted
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 50 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
            if (gameHistory.length > 50) {
                gameHistory = gameHistory.slice(-50);
            }
        }

        function undoLastAction() {
            if (gameHistory.length === 0) {
                alert('–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–º–µ–Ω—ã');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const previousState = gameHistory.pop();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            window.scoreLeft = previousState.scoreLeft;
            window.scoreRight = previousState.scoreRight;
            shuttlecockPosition = previousState.shuttlecockPosition;
            window.gameStarted = previousState.gameStarted;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateScore();
            updateShuttlecockDisplay();
            checkGameReady();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('court_score_left', String(window.scoreLeft));
            localStorage.setItem('court_score_right', String(window.scoreRight));
            localStorage.setItem('court_shuttlecock_position', shuttlecockPosition);
            
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ –±—ã–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            if (!window.gameStarted) {
                stopTimer();
            }
        }

        function load() {
            ids.forEach(id => {
                const v = localStorage.getItem('court_' + id);
                if (v !== null) document.getElementById(id).value = v;
                // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–º—è –∏–∑ HTML
                if (document.getElementById(id).value.trim() === '') {
                    // –ü–æ–ª–µ —É–∂–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ HTML, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º
                }
            });
            const sL = localStorage.getItem('court_score_left');
            const sR = localStorage.getItem('court_score_right');
            const sP = localStorage.getItem('court_shuttlecock_position');
            window.scoreLeft = sL !== null ? parseInt(sL, 10) || 0 : 0;
            window.scoreRight = sR !== null ? parseInt(sR, 10) || 0 : 0;
            shuttlecockPosition = sP !== null ? sP : 'top_right';
            updateScore();
            updateShuttlecockDisplay();
            checkGameReady();
        }

        function save() {
            ids.forEach(id => {
                const v = document.getElementById(id).value || '';
                localStorage.setItem('court_' + id, v);
            });
            localStorage.setItem('court_score_left', String(window.scoreLeft));
            localStorage.setItem('court_score_right', String(window.scoreRight));
            alert('–ò–º–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function clearAll() {
            ids.forEach(id => {
                localStorage.removeItem('court_' + id);
                document.getElementById(id).value = '';
            });
            window.scoreLeft = 0; window.scoreRight = 0;
            shuttlecockPosition = 'top_right';
            window.gameStarted = false;
            clearJournal();
            document.getElementById('btnStartGame').disabled = true;
            document.getElementById('btnStartGame').textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
            localStorage.removeItem('court_score_left');
            localStorage.removeItem('court_score_right');
            localStorage.removeItem('court_shuttlecock_position');
            updateScore();
            updateShuttlecockDisplay();
        }

        function updateScore() {
            document.getElementById('scoreLeft').textContent = window.scoreLeft;
            document.getElementById('scoreRight').textContent = window.scoreRight;
        }

        function checkVictory() {
            if (window.scoreLeft >= 21) {
                window.gameStarted = false;
                document.getElementById('btnStartGame').textContent = '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                setTimeout(() => {
                    showVictoryModal('–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–ª–µ–≤–∞!');
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    setTimeout(() => {
                        window.scoreLeft = 0;
                        window.scoreRight = 0;
                        updateScore();
                        localStorage.setItem('court_score_left', String(window.scoreLeft));
                        localStorage.setItem('court_score_right', String(window.scoreRight));
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        document.getElementById('btnStartGame').textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
                        document.getElementById('btnStartGame').disabled = false;
                    }, 2000); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                }, 100);
                return true;
            }
            if (window.scoreRight >= 21) {
                window.gameStarted = false;
                document.getElementById('btnStartGame').textContent = '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                setTimeout(() => {
                    showVictoryModal('–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–ø—Ä–∞–≤–∞!');
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    setTimeout(() => {
                        window.scoreLeft = 0;
                        window.scoreRight = 0;
                        updateScore();
                        localStorage.setItem('court_score_left', String(window.scoreLeft));
                        localStorage.setItem('court_score_right', String(window.scoreRight));
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        document.getElementById('btnStartGame').textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
                        document.getElementById('btnStartGame').disabled = false;
                    }, 2000); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                }, 100);
                return true;
            }
            return false;
        }

        function showVictoryModal(message) {
            document.getElementById('victoryMessage').textContent = message;
            document.getElementById('victoryModal').style.display = 'block';
        }

        function closeVictoryModal() {
            document.getElementById('victoryModal').style.display = 'none';
        }

        function checkGameReady() {
            const allNamesFilled = ids.every(id => {
                const value = document.getElementById(id).value.trim();
                return value !== '';
            });
            
            const startButton = document.getElementById('btnStartGame');
            if (allNamesFilled && !window.gameStarted) {
                startButton.disabled = false;
            } else {
                startButton.disabled = true;
            }
        }

        function startGame() {
            console.log('–ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É...');
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã
            saveGameState();
            
            window.gameStarted = true;
            console.log('gameStarted —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤:', window.gameStarted);
            currentGameId = generateGameId();
            gameEndTime = null;
            journalEntries = []; // –û—á–∏—â–∞–µ–º –∂—É—Ä–Ω–∞–ª –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            updateJournalDisplay();
            
            document.getElementById('btnStartGame').disabled = true;
            document.getElementById('btnStartGame').textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å';
            console.log('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ');
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function getPlayerName(position) {
            return document.getElementById('name_' + position).value || '–ò–≥—Ä–æ–∫ ' + position;
        }

        function getReceivingPlayer(servingPosition) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ-—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ)
            if (servingPosition === 'top_left') return 'top_right';
            if (servingPosition === 'bottom_left') return 'bottom_right';
            if (servingPosition === 'top_right') return 'top_left';
            if (servingPosition === 'bottom_right') return 'bottom_left';
            return 'unknown';
        }

        function addJournalEntry(servingPosition, isSuccess) {
            if (!window.gameStarted) return;
            
            const servingPlayer = getPlayerName(servingPosition);
            const receivingPosition = getReceivingPlayer(servingPosition);
            const receivingPlayer = getPlayerName(receivingPosition);
            const currentTime = getCurrentTime();
            
            const entry = {
                servingPlayer: servingPlayer,
                receivingPlayer: receivingPlayer,
                isSuccess: isSuccess,
                time: currentTime,
                timestamp: new Date(),
                scoreAfter: `${window.scoreLeft}:${window.scoreRight}` // –î–æ–±–∞–≤–ª—è–µ–º —Å—á—ë—Ç –ø–æ—Å–ª–µ –ø–æ–¥–∞—á–∏
            };
            
            journalEntries.push(entry);
            updateJournalDisplay();
        }

        function updateJournalDisplay() {
            const journalContent = document.getElementById('journalContent');
            
            if (journalEntries.length === 0) {
                journalContent.innerHTML = '<div class="journal-placeholder">–ñ—É—Ä–Ω–∞–ª –Ω–∞—á–Ω–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>';
                return;
            }
            
            let html = '';
            journalEntries.forEach(entry => {
                const resultClass = entry.isSuccess ? 'success' : 'returned';
                const resultText = entry.isSuccess ? '–û—á–∫–æ –ø–æ–ª—É—á–µ–Ω–æ' : '–ü–æ–¥–∞—á–∞ –æ—Ç–±–∏—Ç–∞';
                
                html += `
                    <div class="journal-entry ${resultClass}">
                        <div class="entry-time">${entry.time}</div>
                        <div class="entry-players">${entry.servingPlayer} ‚Üí ${entry.receivingPlayer}</div>
                        <div class="entry-result ${resultClass}">${resultText}</div>
                        <div class="entry-score">–°—á—ë—Ç: ${entry.scoreAfter || '0:0'}</div>
                    </div>
                `;
            });
            
            journalContent.innerHTML = html;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
            journalContent.scrollTop = journalContent.scrollHeight;
        }

        function clearJournal() {
            journalEntries = [];
            updateJournalDisplay();
        }

        function generateGameId() {
            return 'game_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showStatistics() {
            if (journalEntries.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalServes = journalEntries.length;
            const successfulServes = journalEntries.filter(entry => entry.isSuccess).length;
            const successRate = Math.round((successfulServes / totalServes) * 100);
            
            const statsContent = document.getElementById('journalContent');
            statsContent.innerHTML = `
                <div class="stats-content">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h4>
                    <div class="game-summary">
                        <h5>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h5>
                        <p>–í—Å–µ–≥–æ –ø–æ–¥–∞—á: ${totalServes}</p>
                        <p>–£—Å–ø–µ—à–Ω—ã—Ö –ø–æ–¥–∞—á: ${successfulServes}</p>
                        <p>–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: ${successRate}%</p>
                    </div>
                </div>
            `;
        }

        function toggleJournalSize() {
            const container = document.querySelector('.journal-container');
            container.classList.toggle('expanded');
            
            const btn = document.getElementById('btnExpandJournal');
            btn.textContent = container.classList.contains('expanded') ? 'üìï' : 'üìñ';
        }

        function toggleJournalVisibility() {
            const container = document.querySelector('.journal-container');
            const btn = document.getElementById('btnToggleJournal');
            
            container.classList.toggle('visible');
            
            if (container.classList.contains('visible')) {
                btn.textContent = 'üìã –°–∫—Ä—ã—Ç—å –∂—É—Ä–Ω–∞–ª';
                btn.style.backgroundColor = '#f44336';
            } else {
                btn.textContent = 'üìã –ñ—É—Ä–Ω–∞–ª –ø–æ–¥–∞—á';
                btn.style.backgroundColor = '';
            }
        }

        function updateShuttlecockDisplay() {
            // –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è —É–∂–µ –∏–¥–µ—Ç, –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—É—é
            if (isAnimating) return;
            
            // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –≤–∏–¥–∏–º—ã–π –≤–æ–ª–∞–Ω
            const currentIndicator = document.querySelector('.server-indicator[style*="display: block"]');
            
            if (currentIndicator) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏
                isAnimating = true;
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–µ–∫—É—â–µ–π –∏ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–π
                const currentRect = currentIndicator.getBoundingClientRect();
                const targetSegment = document.getElementById(shuttlecockPosition);
                const targetIndicator = targetSegment.querySelector('.server-indicator');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–ª–µ–≤–æ–π –≤–æ–ª–∞–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                targetIndicator.style.display = 'block';
                const targetRect = targetIndicator.getBoundingClientRect();
                targetIndicator.style.display = 'none';
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                const deltaX = targetRect.left - currentRect.left;
                const deltaY = targetRect.top - currentRect.top;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º transform –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                currentIndicator.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
                currentIndicator.style.zIndex = '1000';
                
                // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤–æ–ª–∞–Ω –≤ —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
                setTimeout(() => {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º transform
                    currentIndicator.style.transform = '';
                    currentIndicator.style.zIndex = '';
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ª–∞–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
                    currentIndicator.style.display = 'none';
                    targetIndicator.style.display = 'block';
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏
                    isAnimating = false;
                }, 200);
            } else {
                // –ï—Å–ª–∏ –≤–æ–ª–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
                document.querySelectorAll('.server-indicator').forEach(el => el.style.display = 'none');
                const targetSegment = document.getElementById(shuttlecockPosition);
                const targetIndicator = targetSegment.querySelector('.server-indicator');
                if (targetIndicator) {
                    targetIndicator.style.display = 'block';
                }
            }
        }

        function moveShuttlecock(side) {
            if (side === 'left') {
                shuttlecockPosition = shuttlecockPosition === 'top_left' ? 'bottom_left' : 'top_left';
            } else {
                shuttlecockPosition = shuttlecockPosition === 'top_right' ? 'bottom_right' : 'top_right';
            }
            updateShuttlecockDisplay();
            localStorage.setItem('court_shuttlecock_position', shuttlecockPosition);
        }

        function swapPlayers(side) {
            if (side === 'left') {
                const topValue = document.getElementById('name_top_left').value;
                const bottomValue = document.getElementById('name_bottom_left').value;
                document.getElementById('name_top_left').value = bottomValue;
                document.getElementById('name_bottom_left').value = topValue;
            } else {
                const topValue = document.getElementById('name_top_right').value;
                const bottomValue = document.getElementById('name_bottom_right').value;
                document.getElementById('name_top_right').value = bottomValue;
                document.getElementById('name_bottom_right').value = topValue;
            }
        }

        function moveShuttlecockBetweenSides() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
            saveGameState();
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤–æ–ª–∞–Ω –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ: top_right ‚Üí top_left ‚Üí bottom_left ‚Üí bottom_right ‚Üí top_right
            if (shuttlecockPosition === 'top_right') {
                shuttlecockPosition = 'top_left';
            } else if (shuttlecockPosition === 'top_left') {
                shuttlecockPosition = 'bottom_left';
            } else if (shuttlecockPosition === 'bottom_left') {
                shuttlecockPosition = 'bottom_right';
            } else if (shuttlecockPosition === 'bottom_right') {
                shuttlecockPosition = 'top_right';
            }
            updateShuttlecockDisplay();
            localStorage.setItem('court_shuttlecock_position', shuttlecockPosition);
        }

        window.addPointLeft = function() {
            console.log('addPointLeft –≤—ã–∑–≤–∞–Ω–∞, gameStarted:', window.gameStarted);
            if (!window.gameStarted) {
                console.log('–ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, –≤—ã—Ö–æ–¥–∏–º');
                return; // –ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
            saveGameState();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –≤–æ–ª–∞–Ω –Ω–∞ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
            const isShuttlecockOnLeft = shuttlecockPosition.includes('left');
            
            if (isShuttlecockOnLeft) {
                // –í–æ–ª–∞–Ω –Ω–∞ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –∏ –º–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–æ–≤ (–ø–æ–¥–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞)
                window.scoreLeft += 1;
                updateScore();
                localStorage.setItem('court_score_left', String(window.scoreLeft));
                addJournalEntry(shuttlecockPosition, true); // –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–∞—á–∞
                moveShuttlecock('left');
                swapPlayers('left');
                checkVictory();
            } else {
                // –í–æ–ª–∞–Ω –ù–ï –Ω–∞ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ - –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–∏–≥—Ä–∞–ª–∞
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–æ —Å–Ω–∞—á–∞–ª–∞, —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç
                window.scoreLeft += 1;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ç–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞ –ª–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
                if (window.scoreLeft % 2 === 0) {
                    // –ß–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ - –ø–æ–¥–∞—á–∞ –∏–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    shuttlecockPosition = 'top_left';
                } else {
                    // –ù–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ - –ø–æ–¥–∞—á–∞ –∏–∑ –Ω–∏–∂–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    shuttlecockPosition = 'bottom_left';
                }
                
                updateShuttlecockDisplay();
                localStorage.setItem('court_shuttlecock_position', shuttlecockPosition);
                updateScore();
                localStorage.setItem('court_score_left', String(window.scoreLeft));
                addJournalEntry(shuttlecockPosition, false); // –ü–æ–¥–∞—á–∞ –æ—Ç–±–∏—Ç–∞
                checkVictory();
                return; // –í—ã—Ö–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            }
        }

        window.addPointRight = function() {
            if (!window.gameStarted) return; // –ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
            saveGameState();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –≤–æ–ª–∞–Ω –Ω–∞ –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
            const isShuttlecockOnRight = shuttlecockPosition.includes('right');
            
            if (isShuttlecockOnRight) {
                // –í–æ–ª–∞–Ω –Ω–∞ –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –∏ –º–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–æ–≤ (–ø–æ–¥–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞)
                window.scoreRight += 1;
                updateScore();
                localStorage.setItem('court_score_right', String(window.scoreRight));
                addJournalEntry(shuttlecockPosition, true); // –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–∞—á–∞
                moveShuttlecock('right');
                swapPlayers('right');
                checkVictory();
            } else {
                // –í–æ–ª–∞–Ω –ù–ï –Ω–∞ –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ - –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–∏–≥—Ä–∞–ª–∞
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–æ —Å–Ω–∞—á–∞–ª–∞, —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç
                window.scoreRight += 1;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ç–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞ –ø—Ä–∞–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
                if (window.scoreRight % 2 === 0) {
                    // –ß–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ - –ø–æ–¥–∞—á–∞ –∏–∑ –Ω–∏–∂–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    shuttlecockPosition = 'bottom_right';
                } else {
                    // –ù–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ - –ø–æ–¥–∞—á–∞ –∏–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    shuttlecockPosition = 'top_right';
                }
                
                updateShuttlecockDisplay();
                localStorage.setItem('court_shuttlecock_position', shuttlecockPosition);
                updateScore();
                localStorage.setItem('court_score_right', String(window.scoreRight));
                addJournalEntry(shuttlecockPosition, false); // –ü–æ–¥–∞—á–∞ –æ—Ç–±–∏—Ç–∞
                checkVictory();
                return; // –í—ã—Ö–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ
        function sendResultToParent() {
            const result = {
                scoreLeft: window.scoreLeft,
                scoreRight: window.scoreRight,
                player1: document.getElementById('name_top_left').value,
                player2: document.getElementById('name_bottom_left').value,
                player3: document.getElementById('name_top_right').value,
                player4: document.getElementById('name_bottom_right').value,
                journal: journalEntries
            };
            
            if (window.opener) {
                window.opener.postMessage({
                    type: 'refereeResult',
                    result: result
                }, '*');
                window.close();
            } else {
                // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ popup, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                window.history.back();
            }
        }

        document.getElementById('btnSave').addEventListener('click', save);
        document.getElementById('btnClear').addEventListener('click', clearAll);
        document.getElementById('btnUndo').addEventListener('click', undoLastAction);
        document.getElementById('btnMoveShuttlecock').addEventListener('click', moveShuttlecockBetweenSides);
        document.getElementById('btnStartGame').addEventListener('click', startGame);
        document.getElementById('btnToggleJournal').addEventListener('click', toggleJournalVisibility);
        document.getElementById('btnExpandJournal').addEventListener('click', toggleJournalSize);
        document.getElementById('btnShowStats').addEventListener('click', showStatistics);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–æ—Ä—Ç—É
        document.getElementById('court_left').addEventListener('click', function(event) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
            if (event.target.tagName !== 'INPUT') {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
                this.classList.add('clicked');
                setTimeout(() => this.classList.remove('clicked'), 300);
                addPointLeft();
            }
        });
        
        document.getElementById('court_right').addEventListener('click', function(event) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
            if (event.target.tagName !== 'INPUT') {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
                this.classList.add('clicked');
                setTimeout(() => this.classList.remove('clicked'), 300);
                addPointRight();
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–≥—Ä–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        ids.forEach(id => {
            document.getElementById(id).addEventListener('input', checkGameReady);
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('victoryModal');
            if (event.target === modal) {
                closeVictoryModal();
            }
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ç—á" –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const controls = document.querySelector('.controls');
            const finishBtn = document.createElement('button');
            finishBtn.textContent = '‚úï';
            finishBtn.className = 'btn btn-primary finish-btn';
            finishBtn.title = '–ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ç—á';
            finishBtn.style.marginLeft = '0px';
            finishBtn.onclick = function() {
                sendResultToParent();
            };
            controls.appendChild(finishBtn);
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å
        if (!clearData) {
            load();
        }
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
            checkGameReady();
        }, 100);
        
        // –ü–æ–ø—ã—Ç–∫–∞ —Å–∫—Ä—ã—Ç—å –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É –±—Ä–∞—É–∑–µ—Ä–∞
        function hideAddressBar() {
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É
            if (window.screen && window.screen.availHeight) {
                // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                window.scrollTo(0, 1);
            }
            
            // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            if (window.chrome && window.chrome.app && window.chrome.app.isInstalled) {
                // Chrome app mode
                document.body.style.height = '100vh';
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–∫—Ä—ã—Ç–∏—è
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                document.title = '';
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã
                document.documentElement.style.height = '100vh';
                document.documentElement.style.width = '100vw';
                document.documentElement.style.overflow = 'hidden';
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞
                const style = document.createElement('style');
                style.textContent = `
                    * { 
                        -webkit-user-select: none !important;
                        -moz-user-select: none !important;
                        -ms-user-select: none !important;
                        user-select: none !important;
                    }
                    html, body {
                        margin: 0 !important;
                        padding: 0 !important;
                        overflow: hidden !important;
                        height: 100vh !important;
                        width: 100vw !important;
                    }
                    head, title, meta {
                        display: none !important;
                        visibility: hidden !important;
                        opacity: 0 !important;
                    }
                `;
                document.head.appendChild(style);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–∫—Ä—ã—Ç–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                const titleElement = document.querySelector('title');
                if (titleElement) {
                    titleElement.textContent = '';
                    titleElement.style.display = 'none';
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–∞-—Ç–µ–≥–∏
                const metaTags = document.querySelectorAll('meta');
                metaTags.forEach(meta => {
                    meta.style.display = 'none';
                    meta.style.visibility = 'hidden';
                });
                
            } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞:', e);
            }
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', hideAddressBar);
        window.addEventListener('resize', hideAddressBar);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.title = '';
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É
            setTimeout(() => {
                window.scrollTo(0, 1);
                hideAddressBar();
            }, 100);
            
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫–∏ —Å–∫—Ä—ã—Ç–∏—è
            setInterval(() => {
                document.title = '';
                window.scrollTo(0, 1);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–∫—Ä—ã—Ç–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                const titleElement = document.querySelector('title');
                if (titleElement) {
                    titleElement.textContent = '';
                    titleElement.style.display = 'none';
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–∞-—Ç–µ–≥–∏
                const metaTags = document.querySelectorAll('meta');
                metaTags.forEach(meta => {
                    meta.style.display = 'none';
                    meta.style.visibility = 'hidden';
                });
                
            }, 1000);
        });
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        function forceHideTitle() {
            try {
                // –û—á–∏—â–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                document.title = '';
                
                // –°–∫—Ä—ã–≤–∞–µ–º title —ç–ª–µ–º–µ–Ω—Ç
                const titleElement = document.querySelector('title');
                if (titleElement) {
                    titleElement.textContent = '';
                    titleElement.style.display = 'none';
                    titleElement.style.visibility = 'hidden';
                    titleElement.style.opacity = '0';
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–∞-—Ç–µ–≥–∏
                const metaTags = document.querySelectorAll('meta');
                metaTags.forEach(meta => {
                    meta.style.display = 'none';
                    meta.style.visibility = 'hidden';
                    meta.style.opacity = '0';
                });
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã
                document.documentElement.style.height = '100vh';
                document.documentElement.style.width = '100vw';
                document.documentElement.style.overflow = 'hidden';
                document.documentElement.style.margin = '0';
                document.documentElement.style.padding = '0';
                
                document.body.style.height = '100vh';
                document.body.style.width = '100vw';
                document.body.style.overflow = 'hidden';
                document.body.style.margin = '0';
                document.body.style.padding = '0';
                document.body.style.position = 'fixed';
                document.body.style.top = '0';
                document.body.style.left = '0';
                
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:', e);
            }
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è
        forceHideTitle();
        setInterval(forceHideTitle, 500);
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        function adaptToScreenSize() {
            const court = document.querySelector('.court');
            const scoreboard = document.querySelector('.scoreboard-container');
            const scores = document.querySelectorAll('.score-left, .score-right');
            const inputs = document.querySelectorAll('input');
            
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const controlsHeight = document.querySelector('.controls').offsetHeight;
            const availableHeight = windowHeight - controlsHeight;
            const aspectRatio = windowWidth / availableHeight;
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ—Ä—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –æ–±–ª–∞—Å—Ç—å
            court.style.width = '100%';
            court.style.height = '100%';
            court.style.backgroundSize = 'contain';
            court.style.backgroundPosition = 'center center';
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ —Å—á–µ—Ç–∞ - 52.5% –æ—Ç –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞ (70% * 0.75)
            const scoreFontSize = availableHeight * 0.525;
            scores.forEach(score => {
                score.style.fontSize = Math.max(scoreFontSize, 30) + 'px';
            });
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            const inputWidth = Math.min(windowWidth * 0.12, 200); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤ 2 —Ä–∞–∑–∞
            inputs.forEach(input => {
                input.style.width = Math.max(inputWidth, 100) + 'px';
                input.style.fontSize = Math.max(inputWidth * 0.18, 24) + 'px'; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç –≤ 3 —Ä–∞–∑–∞
            });
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –æ—Ç—Å—Ç—É–ø–æ–≤ –¥–ª—è —Å—á–µ—Ç–æ–≤
            const scoreGap = Math.min(windowWidth * 0.1, 100);
            if (scoreboard) {
                scoreboard.style.gap = scoreGap + 'px';
            }
        }
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        if (clearData) {
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            document.getElementById('name_top_left').value = '';
            document.getElementById('name_bottom_left').value = '';
            document.getElementById('name_top_right').value = '';
            document.getElementById('name_bottom_right').value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            updateScore();
            
            // –û—á–∏—â–∞–µ–º –∂—É—Ä–Ω–∞–ª
            updateJournalDisplay();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–¥–∞—á–∏
            document.querySelectorAll('.server-indicator').forEach(indicator => {
                indicator.style.display = 'none';
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –≤–æ–ª–∞–Ω–∞
            moveShuttlecock('top_right');
        }

        // –í—ã–∑—ã–≤–∞–µ–º –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('load', adaptToScreenSize);
        window.addEventListener('resize', adaptToScreenSize);
        window.addEventListener('orientationchange', function() {
            setTimeout(adaptToScreenSize, 100);
        });
    </script>
</body>
</html>