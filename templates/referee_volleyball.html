<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>–°—É–¥–µ–π—Å—Ç–≤–æ –≤–æ–ª–µ–π–±–æ–ª–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .referee-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .referee-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 900px;
            width: 100%;
            text-align: center;
        }
        
        .volleyball-court {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 3px solid #dc3545;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
        }
        
        .court-center-line {
            display: none;
        }
        
        .court-net {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 60px;
            background: #dc3545;
            border-radius: 2px;
        }
        
        .team-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –∫–æ–º–∞–Ω–¥ */
.team-section.swapped { flex-direction: row-reverse; }
        
        .team-info {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
            margin: 0 10px;
        }
        /* –ö—Ä–∞—Å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (A) */
        .team-info.team-a { background: rgba(220, 53, 69, 0.1); }
        .team-info.team-a .team-name { color: #dc3545; }
        .team-info.team-a .score-display { color: #dc3545; }
        /* –°–∏–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ (B) */
        .team-info.team-b { background: rgba(0, 123, 255, 0.1); }
        .team-info.team-b .team-name { color: #007bff; }
        .team-info.team-b .score-display { color: #007bff; }
        
        .team-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .score-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .set-scores {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .set-score {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            min-width: 50px;
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn-volleyball {
            background: #dc3545;
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-volleyball:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
        
        .btn-volleyball-blue {
            background: #0d6efd;
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-volleyball-blue:hover {
            background: #0b5ed7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3);
        }
        
        .btn-secondary-volleyball {
            background: #6c757d;
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .btn-secondary-volleyball:hover {
            background: #5a6268;
        }
        
        .match-info {
            background: rgba(220, 53, 69, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .match-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .current-set {
            font-size: 1.2rem;
            color: #666;
        }
        
        .serve-indicator {
            position: absolute;
            top: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
            animation: pulse 2s infinite;
        }
        /* –ü–æ–∑–∏—Ü–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–¥–∞—á–∏ */
        .serve-indicator.pos-left { left: 20px; right: auto; }
        .serve-indicator.pos-right { right: 20px; left: auto; }
        
        .serve-indicator.team-a {
            background: #dc3545;
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }
        
        .serve-indicator.team-b {
            background: #007bff;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            .team-section {
                flex-direction: column;
                gap: 20px;
            }
            
            .team-info {
                margin: 0;
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-volleyball, .btn-secondary-volleyball {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <a href="/referee" class="back-button">
        <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥
    </a>
    
    <div class="referee-container">
        <div class="referee-card">
            <div class="match-info">
                <h1 class="match-title">
                    <i class="fas fa-volleyball-ball me-3"></i>–°—É–¥–µ–π—Å—Ç–≤–æ –≤–æ–ª–µ–π–±–æ–ª–∞
                </h1>
                <div class="current-set">–°–µ—Ç 1 –∏–∑ 3</div>
                <div class="serve-indicator team-a pos-left" id="serveIndicator">
                    <i class="fas fa-volleyball-ball me-2"></i>–ü–æ–¥–∞—á–∞: –ö–æ–º–∞–Ω–¥–∞ –ê
                </div>
            </div>
            
            <div class="volleyball-court">
                <div class="court-center-line"></div>
                <div class="court-net"></div>
                
                <div class="team-section">
                    <div class="team-info team-a">
                        <div class="team-name">–ö–æ–º–∞–Ω–¥–∞ –ê</div>
                        <div class="score-display" id="teamAScore">0</div>
                    </div>
                    
                    <div class="team-info team-b">
                        <div class="team-name">–ö–æ–º–∞–Ω–¥–∞ –ë</div>
                        <div class="score-display" id="teamBScore">0</div>
                    </div>
                </div>
                
                <div class="set-scores">
                    <div class="set-score">–°–µ—Ç 1: 0-0</div>
                    <div class="set-score">–°–µ—Ç 2: 0-0</div>
                    <div class="set-score">–°–µ—Ç 3: 0-0</div>
                </div>
            </div>
            
            <div class="control-buttons" id="controlButtonsContainer">
                <button class="btn btn-volleyball" id="btnPointA" onclick="addPoint('A')">
                    <i class="fas fa-plus me-2"></i>–û—á–∫–æ –∫–æ–º–∞–Ω–¥–µ –ê
                </button>
                <button class="btn btn-volleyball-blue" id="btnPointB" onclick="addPoint('B')">
                    <i class="fas fa-plus me-2"></i>–û—á–∫–æ –∫–æ–º–∞–Ω–¥–µ –ë
                </button>
                <button class="btn btn-secondary-volleyball" onclick="undoLastPoint()">
                    <i class="fas fa-undo me-2"></i>–û—Ç–º–µ–Ω–∏—Ç—å
                </button>
                <button class="btn btn-secondary-volleyball" onclick="resetMatch()">
                    <i class="fas fa-refresh me-2"></i>–°–±—Ä–æ—Å
                </button>
                <button class="btn btn-secondary-volleyball" onclick="swapTeamsSides()">
                    <i class="fas fa-exchange-alt me-2"></i>–ü–æ–º–µ–Ω—è—Ç—å —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–º–∞–Ω–¥
                </button>
                <button class="btn btn-secondary-volleyball" onclick="swapServe()">
                    <i class="fas fa-retweet me-2"></i>–ü–æ–º–µ–Ω—è—Ç—å –ø–æ–¥–∞—é—â—É—é —Å—Ç–æ—Ä–æ–Ω—É
                </button>
                <button class="btn btn-success" onclick="saveToTournament()" id="btnSaveToTournament" style="display: none; font-weight: bold; box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);">
                    <i class="fas fa-trophy me-2"></i>üèÜ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç—É—Ä–Ω–∏—Ä
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentSet = 1;
        let teamAScore = 0;
        let teamBScore = 0;
        let setScores = [[0, 0], [0, 0], [0, 0]];
        let gameHistory = [];
        let servingTeam = 'A'; // –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–∞–µ—Ç
        let sidesSwapped = false; // –§–ª–∞–≥ –æ–±–º–µ–Ω–∞ —Å—Ç–æ—Ä–æ–Ω
        
        function addPoint(team) {
            if (team === 'A') {
                teamAScore++;
            } else {
                teamBScore++;
            }
            
            console.log('[Volleyball] addPoint(): –∫–æ–º–∞–Ω–¥–∞', team, ', –Ω–æ–≤—ã–π —Å—á–µ—Ç:', teamAScore, ':', teamBScore);
            
            // –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∏–≥—Ä–∞–ª–∞ –æ—á–∫–æ, –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–æ –ø–æ–¥–∞—á–∏
            servingTeam = team;
            
            gameHistory.push({
                team: team,
                set: currentSet,
                score: [teamAScore, teamBScore]
            });
            
            updateDisplay();
            checkSetEnd();
        }
        
        function updateDisplay() {
            document.getElementById('teamAScore').textContent = teamAScore;
            document.getElementById('teamBScore').textContent = teamBScore;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç —Å–µ—Ç–æ–≤
            setScores[currentSet - 1] = [teamAScore, teamBScore];
            updateSetScores();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ–¥–∞—á–∏
            updateServeIndicator();
        }
        
        function updateServeIndicator() {
            const indicator = document.getElementById('serveIndicator');
            const nameA = window.team1Name || '–ö–æ–º–∞–Ω–¥–∞ –ê';
            const nameB = window.team2Name || '–ö–æ–º–∞–Ω–¥–∞ –ë';
            if (servingTeam === 'A') {
                indicator.className = 'serve-indicator team-a ' + (sidesSwapped ? 'pos-right' : 'pos-left');
                indicator.innerHTML = '<i class="fas fa-volleyball-ball me-2"></i>–ü–æ–¥–∞—á–∞: ' + nameA;
            } else {
                indicator.className = 'serve-indicator team-b ' + (sidesSwapped ? 'pos-left' : 'pos-right');
                indicator.innerHTML = '<i class="fas fa-volleyball-ball me-2"></i>–ü–æ–¥–∞—á–∞: ' + nameB;
            }
        }

        // –û–±–º–µ–Ω —Å—Ç–æ—Ä–æ–Ω –∫–æ–º–∞–Ω–¥ (–ª–µ–≤–æ/–ø—Ä–∞–≤–æ)
        function swapTeamsSides() {
            const section = document.querySelector('.team-section');
            if (section) {
                sidesSwapped = !sidesSwapped;
                section.classList.toggle('swapped', sidesSwapped);
                updateServeIndicator();
                
                // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫–∏ –º–µ—Å—Ç–∞–º–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–æ—Ä–æ–Ω
                swapPointButtons();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—á–∫–æ–≤ –º–µ—Å—Ç–∞–º–∏
        function swapPointButtons() {
            const container = document.getElementById('controlButtonsContainer');
            const btnA = document.getElementById('btnPointA');
            const btnB = document.getElementById('btnPointB');
            
            if (container && btnA && btnB) {
                // –ï—Å–ª–∏ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–º–µ–Ω—è–Ω—ã, –º–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫–Ω–æ–ø–æ–∫
                if (sidesSwapped) {
                    // –ö–Ω–æ–ø–∫–∞ B —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–≤–æ–π
                    container.insertBefore(btnB, btnA);
                } else {
                    // –ö–Ω–æ–ø–∫–∞ A —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–≤–æ–π
                    container.insertBefore(btnA, btnB);
                }
            }
        }

        // –û–±–º–µ–Ω –ø–æ–¥–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
        function swapServe() {
            servingTeam = (servingTeam === 'A') ? 'B' : 'A';
            updateServeIndicator();
        }
        
        function updateSetScores() {
            const setElements = document.querySelectorAll('.set-score');
            setElements.forEach((element, index) => {
                if (index < setScores.length) {
                    element.textContent = `–°–µ—Ç ${index + 1}: ${setScores[index][0]}-${setScores[index][1]}`;
                }
            });
        }
        
        function checkSetEnd() {
            const maxScore = 25;
            const minAdvantage = 2;
            
            if (teamAScore >= maxScore || teamBScore >= maxScore) {
                if (Math.abs(teamAScore - teamBScore) >= minAdvantage) {
                    endSet();
                }
            }
        }
        
        function endSet() {
            setScores[currentSet - 1] = [teamAScore, teamBScore];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–µ–Ω –ª–∏ –º–∞—Ç—á
            const setsWonA = setScores.filter(score => score[0] > score[1]).length;
            const setsWonB = setScores.filter(score => score[1] > score[0]).length;
            
            if (setsWonA >= 2 || setsWonB >= 2) {
                const nameA = window.team1Name || '–ö–æ–º–∞–Ω–¥–∞ –ê';
                const nameB = window.team2Name || '–ö–æ–º–∞–Ω–¥–∞ –ë';
                alert(`–ú–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${setsWonA >= 2 ? nameA : nameB}`);
                return;
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–µ—Ç—É
            currentSet++;
            teamAScore = 0;
            teamBScore = 0;
            
            document.querySelector('.current-set').textContent = `–°–µ—Ç ${currentSet} –∏–∑ 3`;
            updateDisplay();
        }
        
        function undoLastPoint() {
            if (gameHistory.length > 0) {
                const lastAction = gameHistory.pop();
                if (lastAction.team === 'A') {
                    teamAScore--;
                } else {
                    teamBScore--;
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ–¥–∞—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
                if (gameHistory.length > 0) {
                    const previousAction = gameHistory[gameHistory.length - 1];
                    servingTeam = previousAction.team;
                } else {
                    // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ–º–∞–Ω–¥–∞ –ê –ø–æ–¥–∞–µ—Ç
                    servingTeam = 'A';
                }
                
                updateDisplay();
            }
        }
        
        function resetMatch() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –º–∞—Ç—á?')) {
                currentSet = 1;
                teamAScore = 0;
                teamBScore = 0;
                setScores = [[0, 0], [0, 0], [0, 0]];
                gameHistory = [];
                servingTeam = 'A'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∞—á—É –Ω–∞ –∫–æ–º–∞–Ω–¥—É –ê
                document.querySelector('.current-set').textContent = '–°–µ—Ç 1 –∏–∑ 3';
                updateDisplay();
            }
        }
        
        function saveToTournament() {
            if (!window.matchId) {
                alert('ID –º–∞—Ç—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—É–¥–µ–π—Å—Ç–≤–∞ –∏–∑ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.');
                return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const sets = [];
            const defaultScore = 25; // –≤–æ–ª–µ–π–±–æ–ª: –∑–Ω–∞—á–µ–Ω–∏–µ "–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" –¥–ª—è –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å—á—ë—Ç–∞
            
            // –§–∏–∫—Å–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –º–∞—Å—Å–∏–≤–µ setScores –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–æ–º
            setScores[currentSet - 1] = [teamAScore, teamBScore];
            console.log('[Volleyball] saveToTournament(): —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç —Å–µ—Ç–∞', currentSet, ':', teamAScore, ':', teamBScore);
            console.log('[Volleyball] saveToTournament(): –º–∞—Å—Å–∏–≤ setScores:', JSON.stringify(setScores));
            
            for (let i = 0; i < setScores.length; i++) {
                const [s1, s2] = setScores[i];
                console.log('[Volleyball] saveToTournament(): –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç', (i+1), ':', s1, ':', s2);
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∏–≥—Ä–∞–Ω–Ω—ã–µ —Å–µ—Ç—ã –∏ –∑–∞—â–∏—Ç—É –æ—Ç 25:25 (–º–∞—Ä–∫–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                if ((s1 === 0 && s2 === 0) || (s1 === defaultScore && s2 === defaultScore)) {
                    console.log('[Volleyball] saveToTournament(): —Å–µ—Ç', (i+1), '–ø—Ä–æ–ø—É—â–µ–Ω (0:0 –∏–ª–∏ 25:25)');
                    continue;
                }
                console.log('[Volleyball] saveToTournament(): —Å–µ—Ç', (i+1), '–¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—Ç–ø—Ä–∞–≤–∫—É');
                sets.push({
                    set_number: i + 1,
                    score1: s1,
                    score2: s2,
                    completed: true
                });
            }
            
            const resultData = {
                sets: sets,
                matchId: window.matchId
            };
            
            console.log('[Volleyball] saveToTournament(): –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ', resultData);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            fetch(`/api/matches/${window.matchId}/save-referee-result`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || ''
                },
                body: JSON.stringify(resultData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ç—É—Ä–Ω–∏—Ä!');
                    // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º postMessage —Ä–æ–¥–∏—Ç–µ–ª—é, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω —á–µ—Ä–µ–∑ API
                    // –ê–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    console.log('[Volleyball] ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º postMessage');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Å—É–¥–µ–π—Å—Ç–≤–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    try { 
                        if (window.opener && !window.opener.closed) {
                            console.log('[Volleyball] –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞');
                            window.opener.location.reload();
                        } else if (window.parent && window.parent !== window) {
                            console.log('[Volleyball] –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                            window.parent.location.reload();
                        }
                        window.close(); 
                    } catch(_) {}
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('[Volleyball] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ —Ç—É—Ä–Ω–∏—Ä:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ç—É—Ä–Ω–∏—Ä');
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateDisplay();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç—É—Ä–Ω–∏—Ä
        function showSaveButton() {
            const urlParams = new URLSearchParams(window.location.search);
            const matchId = urlParams.get('match_id');
            const team1Name = urlParams.get('team1_name');
            const team2Name = urlParams.get('team2_name');
            const setParam = urlParams.get('set');
            const s1Param = urlParams.get('score1');
            const s2Param = urlParams.get('score2');
            console.log('[Volleyball] URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', window.location.search);
            console.log('[Volleyball] matchId –∏–∑ URL:', matchId);
            console.log('[Volleyball] –ö–æ–º–∞–Ω–¥–∞ 1:', team1Name);
            console.log('[Volleyball] –ö–æ–º–∞–Ω–¥–∞ 2:', team2Name);
            console.log('[Volleyball] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—á—ë—Ç–∞:', s1Param, s2Param, '—Å–µ—Ç:', setParam);
            
            if (matchId) {
                window.matchId = matchId;
                const btn = document.getElementById('btnSaveToTournament');
                if (btn) {
                    btn.style.display = 'inline-block';
                    console.log('[Volleyball] –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∞');
                } else {
                    console.error('[Volleyball] –ö–Ω–æ–ø–∫–∞ btnSaveToTournament –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∞ –∏–∑ –±–∞–∑—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ç–æ–≤
                // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
                fetch(`/api/matches/${matchId}?_t=${Date.now()}`, {
                    cache: 'no-store',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('[Volleyball] –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API:', data);
                        if (!data.success || !data.match) {
                            console.error('[Volleyball] –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–∞ –≤ –æ—Ç–≤–µ—Ç–µ');
                            return;
                        }
                        
                        const matchData = data.match;
                        console.log('[Volleyball] –î–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∞ –∏–∑ –ë–î:', matchData);
                        console.log('[Volleyball] –°–µ—Ç—ã –∏–∑ –ë–î: set1=', matchData.set1_score1, ':', matchData.set1_score2, 
                                    'set2=', matchData.set2_score1, ':', matchData.set2_score2,
                                    'set3=', matchData.set3_score1, ':', matchData.set3_score2);
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—á–µ—Ç –≤—Å–µ—Ö —Å–µ—Ç–æ–≤
                        if (matchData.set1_score1 !== null && matchData.set1_score2 !== null) {
                            setScores[0] = [matchData.set1_score1, matchData.set1_score2];
                            console.log('[Volleyball] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–µ—Ç 1:', setScores[0]);
                        }
                        if (matchData.set2_score1 !== null && matchData.set2_score2 !== null) {
                            setScores[1] = [matchData.set2_score1, matchData.set2_score2];
                            console.log('[Volleyball] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–µ—Ç 2:', setScores[1]);
                        }
                        if (matchData.set3_score1 !== null && matchData.set3_score2 !== null) {
                            setScores[2] = [matchData.set3_score1, matchData.set3_score2];
                            console.log('[Volleyball] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–µ—Ç 3:', setScores[2]);
                        }
                        console.log('[Volleyball] –í—Å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ç—ã:', setScores);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–µ—Ç–∞
                        const setParam = new URLSearchParams(window.location.search).get('set');
                        const currentSetNum = setParam ? parseInt(setParam, 10) : 1;
                        console.log('[Volleyball] –¢–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä —Å–µ—Ç–∞ –∏–∑ URL:', currentSetNum);
                        
                        if (currentSetNum >= 1 && currentSetNum <= 3 && setScores[currentSetNum - 1]) {
                            teamAScore = setScores[currentSetNum - 1][0] || 0;
                            teamBScore = setScores[currentSetNum - 1][1] || 0;
                            console.log('[Volleyball] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç —Å–µ—Ç–∞', currentSetNum, ':', teamAScore, ':', teamBScore);
                        } else {
                            console.log('[Volleyball] –°—á–µ—Ç –¥–ª—è —Å–µ—Ç–∞', currentSetNum, '–Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0:0');
                        }
                        
                        updateSetScores();
                        updateDisplay();
                    })
                    .catch(error => {
                        console.error('[Volleyball] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–∞:', error);
                    });
            } else {
                console.log('[Volleyball] matchId –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥, –µ—Å–ª–∏ –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã
            if (team1Name && team2Name) {
                window.team1Name = team1Name;
                window.team2Name = team2Name;
                updateTeamNames(team1Name, team2Name);
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∞—á–∏ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Å—Ä–∞–∑—É
                updateServeIndicator();
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ç–∞ –∏–∑ URL
            const setNum = setParam !== null ? parseInt(setParam, 10) : null;
            if (setNum && setNum >= 1 && setNum <= 3) {
                currentSet = setNum;
                document.querySelector('.current-set').textContent = `–°–µ—Ç ${currentSet} –∏–∑ 3`;
                console.log('[Volleyball] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–µ–∫—É—â–∏–π —Å–µ—Ç:', currentSet);
            }
            
            // –°—á–µ—Ç –±–µ—Ä–µ–º –¢–û–õ–¨–ö–û –∏–∑ –ë–î (—É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤—ã—à–µ —á–µ—Ä–µ–∑ fetch)
            // URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã score1/score2 –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏
            console.log('[Volleyball] –°—á–µ—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –ë–î —á–µ—Ä–µ–∑ fetch');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥
        function updateTeamNames(team1Name, team2Name) {
            console.log('[Volleyball] –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥:', team1Name, 'vs', team2Name);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥
            const teamNameNodes = document.querySelectorAll('.team-name');
            const team1Title = teamNameNodes && teamNameNodes[0];
            const team2Title = teamNameNodes && teamNameNodes[1];
            
            if (team1Title) {
                team1Title.textContent = team1Name;
                console.log('[Volleyball] –û–±–Ω–æ–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–∞–Ω–¥—ã A:', team1Name);
            }
            
            if (team2Title) {
                team2Title.textContent = team2Name;
                console.log('[Volleyball] –û–±–Ω–æ–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–∞–Ω–¥—ã B:', team2Name);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤
            const btnA = document.getElementById('btnPointA');
            const btnB = document.getElementById('btnPointB');
            if (btnA) btnA.innerHTML = '<i class="fas fa-plus me-2"></i>–û—á–∫–æ –∫–æ–º–∞–Ω–¥–µ ' + team1Name;
            if (btnB) btnB.innerHTML = '<i class="fas fa-plus me-2"></i>–û—á–∫–æ –∫–æ–º–∞–Ω–¥–µ ' + team2Name;
        }
        
        // –ü—Ä–æ–±—É–µ–º –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É –∏ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
        showSaveButton();
        setTimeout(showSaveButton, 100);
    </script>
</body>
</html>
