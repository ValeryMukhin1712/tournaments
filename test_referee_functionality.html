<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Referee</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .test-button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .test-result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ Referee</h1>
    
    <div class="test-section">
        <h3>1. –¢–µ—Å—Ç API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML</h3>
        <button class="test-button" onclick="testAPI()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API</button>
        <div id="api-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç JavaScript —Ñ—É–Ω–∫—Ü–∏–π</h3>
        <button class="test-button" onclick="testJavaScript()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JavaScript</button>
        <div id="js-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞</h3>
        <button class="test-button" onclick="testModal()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ</button>
        <div id="modal-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h3>
        <button class="test-button" onclick="testIntegration()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é</button>
        <div id="integration-result" class="test-result"></div>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '–¢–µ—Å—Ç–∏—Ä—É–µ–º API...';
            
            try {
                const response = await fetch('/api/referee/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        participant1: '–ò–≤–∞–Ω-–ü–µ—Ç—Ä',
                        participant2: '–ú–∞—Ä–∏—è',
                        tournament_name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</div>
                        <div>HTML –ø–æ–ª—É—á–µ–Ω: ${data.html.length} —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div>–°–æ–¥–µ—Ä–∂–∏—Ç JavaScript: ${data.html.includes('function') ? '–î–∞' : '–ù–µ—Ç'}</div>
                        <div>–°–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫–∏: ${data.html.includes('button') ? '–î–∞' : '–ù–µ—Ç'}</div>
                        <div>–°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞: ${data.html.includes('input') ? '–î–∞' : '–ù–µ—Ç'}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå API –æ—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</div>`;
            }
        }
        
        function testJavaScript() {
            const resultDiv = document.getElementById('js-result');
            resultDiv.innerHTML = '–¢–µ—Å—Ç–∏—Ä—É–µ–º JavaScript...';
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                const testContainer = document.createElement('div');
                testContainer.innerHTML = `
                    <div id="scoreLeft">0</div>
                    <div id="scoreRight">0</div>
                    <div id="court_left" style="width: 100px; height: 100px; background: green; cursor: pointer;"></div>
                    <div id="court_right" style="width: 100px; height: 100px; background: blue; cursor: pointer;"></div>
                    <button id="btnStartGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    <button id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
                `;
                document.body.appendChild(testContainer);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                window.scoreLeft = 0;
                window.scoreRight = 0;
                window.isGameActive = false;
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
                const tests = [];
                
                // –¢–µ—Å—Ç 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                tests.push('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: ' + (typeof window.scoreLeft !== 'undefined' ? '‚úÖ' : '‚ùå'));
                
                // –¢–µ—Å—Ç 2: –§—É–Ω–∫—Ü–∏—è updateScore
                window.updateScore = function() {
                    document.getElementById('scoreLeft').textContent = window.scoreLeft;
                    document.getElementById('scoreRight').textContent = window.scoreRight;
                };
                window.scoreLeft = 5;
                window.scoreRight = 3;
                window.updateScore();
                const scoreLeftEl = document.getElementById('scoreLeft');
                const scoreRightEl = document.getElementById('scoreRight');
                tests.push('updateScore: ' + (scoreLeftEl.textContent === '5' && scoreRightEl.textContent === '3' ? '‚úÖ' : '‚ùå'));
                
                // –¢–µ—Å—Ç 3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                let clickTest = false;
                const courtLeft = document.getElementById('court_left');
                courtLeft.addEventListener('click', function() {
                    clickTest = true;
                });
                courtLeft.click();
                tests.push('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π: ' + (clickTest ? '‚úÖ' : '‚ùå'));
                
                // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                document.body.removeChild(testContainer);
                
                resultDiv.innerHTML = `
                    <div class="success">‚úÖ JavaScript —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã</div>
                    <div>${tests.join('<br>')}</div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ JavaScript: ${error.message}</div>`;
            }
        }
        
        function testModal() {
            const resultDiv = document.getElementById('modal-result');
            resultDiv.innerHTML = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Bootstrap
                const hasBootstrap = typeof bootstrap !== 'undefined';
                tests.push('Bootstrap: ' + (hasBootstrap ? '‚úÖ' : '‚ùå'));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
                const hasOpenRefereeModal = typeof openRefereeModal !== 'undefined';
                const hasLoadReferee = typeof loadReferee !== 'undefined';
                const hasExecuteRefereeScript = typeof executeRefereeScript !== 'undefined';
                
                const tests = [
                    'Bootstrap: ' + (hasBootstrap ? '‚úÖ' : '‚ùå'),
                    'openRefereeModal: ' + (hasOpenRefereeModal ? '‚úÖ' : '‚ùå'),
                    'loadReferee: ' + (hasLoadReferee ? '‚úÖ' : '‚ùå'),
                    'executeRefereeScript: ' + (hasExecuteRefereeScript ? '‚úÖ' : '‚ùå')
                ];
                
                resultDiv.innerHTML = `
                    <div class="success">‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã</div>
                    <div>${tests.join('<br>')}</div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ${error.message}</div>`;
            }
        }
        
        function testIntegration() {
            const resultDiv = document.getElementById('integration-result');
            resultDiv.innerHTML = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const tests = [];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
                const functions = ['openRefereeModal', 'loadReferee', 'executeRefereeScript', 'setupRefereeMessageHandler'];
                functions.forEach(func => {
                    tests.push(`${func}: ` + (typeof window[func] !== 'undefined' ? '‚úÖ' : '‚ùå'));
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
                const hasMessageListener = window.addEventListener ? '‚úÖ' : '‚ùå';
                tests.push('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π: ' + hasMessageListener);
                
                resultDiv.innerHTML = `
                    <div class="success">‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã</div>
                    <div>${tests.join('<br>')}</div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: ${error.message}</div>`;
            }
        }
        
        function getCSRFToken() {
            const token = document.querySelector('meta[name=csrf-token]');
            return token ? token.getAttribute('content') : '';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã...');
            testAPI();
            testJavaScript();
            testModal();
            testIntegration();
        });
    </script>
</body>
</html>


