# –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

## üîê 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo adduser tournament-admin
sudo usermod -aG sudo tournament-admin

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π
sudo mkdir -p /home/tournament-admin/.ssh
sudo chmod 700 /home/tournament-admin/.ssh
sudo chown tournament-admin:tournament-admin /home/tournament-admin/.ssh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
echo "YOUR_PUBLIC_KEY_HERE" | sudo tee /home/tournament-admin/.ssh/authorized_keys
sudo chmod 600 /home/tournament-admin/.ssh/authorized_keys
sudo chown tournament-admin:tournament-admin /home/tournament-admin/.ssh/authorized_keys

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ root, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞)
sudo nano /etc/ssh/sshd_config
# –î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å:
# Port 2222
# PermitRootLogin no
# PasswordAuthentication no
# PubkeyAuthentication yes

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ SSH
sudo systemctl restart sshd

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
sudo ufw enable
sudo ufw allow 2222/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw status

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Fail2ban
sudo apt update
sudo apt install fail2ban -y
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

## üê≥ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker tournament-admin

# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
newgrp docker

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo apt install docker-compose-plugin -y

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
docker --version
docker compose version
```

## üåê 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
sudo apt update
sudo apt install nginx -y

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
sudo nano /etc/nginx/sites-available/tournament-app

# –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
server {
    listen 80;
    server_name tournaments.sytes.net;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–∞–π—Ç–∞
sudo ln -s /etc/nginx/sites-available/tournament-app /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## üîí 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (Let's Encrypt)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install certbot python3-certbot-nginx -y

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d tournaments.sytes.net

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo certbot renew --dry-run
```

## üìÅ 5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /home/tournament-admin/tournaments
sudo chown tournament-admin:tournament-admin /home/tournament-admin/tournaments

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd /home/tournament-admin/tournaments
git clone https://github.com/ValeryMukhin1712/tournaments.git .

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
cat > Dockerfile << 'EOF'
FROM python:3.11-slim
WORKDIR /app
RUN apt-get update && apt-get install -y gcc && rm -rf /var/lib/apt/lists/*
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
RUN mkdir -p /app/instance
RUN useradd --create-home --shell /bin/bash app && chown -R app:app /app
USER app
EXPOSE 5000
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "2", "app:app"]
EOF

cat > requirements.txt << 'EOF'
Flask==2.3.3
Flask-SQLAlchemy==3.0.5
Flask-Login==0.6.3
Flask-WTF==1.1.1
Flask-Mail==0.9.1
WTForms==3.0.1
python-dotenv==1.0.0
email-validator==2.0.0
Werkzeug==2.3.7
gunicorn==21.2.0
requests==2.31.0
openpyxl==3.1.2
EOF
```

## üöÄ 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–µ–π –¥–ª—è GitHub Actions
ssh-keygen -t rsa -b 4096 -f /home/tournament-admin/.ssh/github_actions -N ""

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ authorized_keys
cat /home/tournament-admin/.ssh/github_actions.pub >> /home/tournament-admin/.ssh/authorized_keys

# –ü–æ–∫–∞–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ GitHub Secrets
cat /home/tournament-admin/.ssh/github_actions
```

## üîß 7. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
cat > /home/tournament-admin/deploy.sh << 'EOF'
#!/bin/bash
set -e
echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π..."
cd /home/tournament-admin/tournaments
docker stop tournament-production-container || true
docker rm tournament-production-container || true
git pull origin main
docker build --no-cache -t tournament-production .
docker run -d -p 5000:5000 --name tournament-production-container tournament-production
echo "üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
EOF

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x /home/tournament-admin/deploy.sh
```

## ‚úÖ 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status docker
sudo systemctl status nginx
sudo systemctl status fail2ban

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep -E ':(80|443|5000)'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certificates

# –¢–µ—Å—Ç —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞
cd /home/tournament-admin/tournaments
docker build -t tournament-test .
```

## üìä 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ htop –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo apt install htop -y

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è Docker
sudo nano /etc/docker/daemon.json
# –î–æ–±–∞–≤–∏—Ç—å:
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker
sudo systemctl restart docker
```

## üîÑ 10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
cat > /home/tournament-admin/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/home/tournament-admin/backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
cp /home/tournament-admin/tournaments/instance/tournament.db $BACKUP_DIR/tournament_$DATE.db

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
cp /etc/nginx/sites-available/tournament-app $BACKUP_DIR/nginx_config_$DATE

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.db" -mtime +7 -delete
find $BACKUP_DIR -name "nginx_config_*" -mtime +7 -delete

echo "–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞: $DATE"
EOF

chmod +x /home/tournament-admin/backup.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
echo "0 2 * * * /home/tournament-admin/backup.sh" | crontab -
```

## üéØ GitHub Secrets –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

- **SERVER_HOST:** IP –∞–¥—Ä–µ—Å –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **SERVER_USER:** tournament-admin
- **SSH_PRIVATE_KEY:** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/home/tournament-admin/.ssh/github_actions`

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
free -h
df -h
htop

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo journalctl -u docker -f
sudo journalctl -u nginx -f
docker logs tournament-production-container

# –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã
docker system prune -a
sudo apt autoremove -y
sudo apt autoclean
```

## üö® –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart docker
sudo systemctl restart nginx
sudo systemctl restart fail2ban

# –û—á–∏—Å—Ç–∫–∞ Docker
docker stop $(docker ps -q) 2>/dev/null || true
docker container prune -f
docker image prune -a -f

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
cp /home/tournament-admin/backups/tournament_YYYYMMDD_HHMMSS.db /home/tournament-admin/tournaments/instance/tournament.db
```

---
*–°–æ–∑–¥–∞–Ω–æ: 08.10.2025*
*–í–µ—Ä—Å–∏—è: 1.0*
*–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞: –¢—É—Ä–Ω–∏—Ä–Ω—ã–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç v2.1*


